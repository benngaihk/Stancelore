# Stancelore - Product Requirements Document

## 1. 产品概述

### 一句话描述
Stancelore 是一款像素风格的 AI 格斗 Roguelike 游戏，玩家扮演教练通过下达战术指令引导 AI 拳手在比赛中获胜。

### 目标用户
- 喜欢策略类游戏的玩家
- 对格斗游戏感兴趣但不擅长操作的玩家
- 喜欢 Roguelike 随机性和养成元素的玩家

### 核心价值
- **差异化定位**: 教练视角而非直接操控，提供独特的策略体验
- **低操作门槛**: 不需要格斗游戏的复杂操作，专注于决策
- **高重玩性**: Roguelike 元素保证每局体验不同

---

## 2. 产品目标

### MVP 目标
验证"AI 概率决策对战 + 教练指令"核心玩法的可行性和趣味性

### 成功指标
- 玩家能明显感受到教练指令对战斗的影响
- 战斗具有节奏感和来回感，不是一边倒
- 核心循环能让玩家产生"再来一局"的欲望

---

## 3. 核心功能需求

### F1: AI 格斗对战系统
**优先级**: P0

**描述**:
两个 AI 拳手根据概率决策表自动进行对战，玩家不直接控制拳手的具体动作。

**功能要点**:
- AI 每 0.3-0.5 秒做一次决策
- 决策基于当前状态（距离、血量）查询概率表
- 属性值对概率进行修正
- 战斗有明确的胜负判定

### F2: 属性系统（六维）
**优先级**: P0

**描述**:
每个拳手拥有六个核心属性，影响 AI 决策概率和战斗数值。

**属性定义**:
| 属性 | 英文 | 作用 |
|------|------|------|
| 力量 | STR | 影响攻击伤害 |
| 敏捷 | AGI | 影响攻击速度、回避概率 |
| 体质 | VIT | 影响 HP、防御力 |
| 技巧 | TEC | 影响暴击率、连招成功率 |
| 意志 | WIL | 影响受击硬直恢复、逆境表现 |
| 直觉 | INT | 影响反击概率、预判成功率 |

### F3: 教练指令系统
**优先级**: P0

**描述**:
玩家通过下达教练指令来改变 AI 的决策倾向，是核心交互方式。

**基础指令**:
- **猛攻**: 攻击概率 ×1.8，防御概率 ×0.3
- **均衡**: 无修正，保持基础概率
- **防守**: 防御概率 ×1.8，攻击概率 ×0.4

**系统规则**:
- 指令下达后有 5 秒冷却时间
- 指令效果立即生效
- 同一时间只有一个指令生效

### F4: 招式系统（三层架构）
**优先级**: P1

**描述**:
招式分为三层结构，提供丰富的战斗变化。

**架构**:
1. **基础动作层**: 刺拳、直拳、勾拳等基础攻击
2. **技能层**: 组合技、特殊技，消耗资源或有冷却
3. **必杀技层**: 强力技能，需要特定条件触发

### F5: 探索系统（节点地图）
**优先级**: P1

**描述**:
Roguelike 风格的节点地图，玩家选择路线推进。

**节点类型**:
- 对战节点：进行拳击比赛
- 训练节点：提升属性或学习招式
- 事件节点：随机事件，奖励或惩罚
- 商店节点：购买道具或服务
- Boss 节点：关卡 Boss 战

### F6: 养成系统（升级/招式管理）
**优先级**: P1

**描述**:
拳手在探索过程中成长。

**功能要点**:
- 经验值获取与等级提升
- 属性点分配
- 招式学习与替换（招式槽位有限）
- 装备系统（简化版）

---

## 4. 用户故事

### 核心游戏循环

```
开始新游戏
    ↓
创建/选择拳手
    ↓
┌─→ 进入节点地图
│       ↓
│   选择下一个节点
│       ↓
│   ┌─ 对战节点 ─→ 进入战斗 ─→ 胜利获得奖励
│   │                    └─→ 失败结算
│   ├─ 训练节点 ─→ 选择训练项目
│   ├─ 事件节点 ─→ 处理随机事件
│   └─ 商店节点 ─→ 购买物品
│       ↓
└── 返回地图继续探索
        ↓
    到达 Boss 节点
        ↓
    Boss 战
        ↓
    通关或失败 → 结算
```

### 战斗流程

```
进入战斗
    ↓
双方拳手就位
    ↓
┌─→ AI 感知当前状态
│       ↓
│   查询决策表获取基础概率
│       ↓
│   应用属性修正
│       ↓
│   应用教练指令修正
│       ↓
│   概率归一化
│       ↓
│   随机选择行动
│       ↓
│   执行行动
│       ↓
│   判定结果（命中/格挡/闪避）
│       ↓
│   更新状态（HP/位置）
│       ↓
│   [玩家可随时下达教练指令]
│       ↓
└── 检查胜负条件 → 未结束则继续
        ↓
    战斗结束
```

---

## 5. 技术约束

### 开发环境
- **引擎**: Godot 4.4
- **语言**: GDScript
- **版本控制**: Git

### 画面规格
- **基础分辨率**: 384 × 216 (16:9)
- **像素风格**: 整数倍缩放
- **目标帧率**: 60 FPS

### 平台
- **MVP**: PC (Windows/macOS/Linux)
- **后续**: 可考虑移动端

---

## 6. MVP 范围定义

### 包含功能 (In Scope)
- [x] 基础 AI 对战系统
- [x] 三个教练指令（猛攻/均衡/防守）
- [x] 简化属性系统
- [x] 基础状态机（7 个状态）
- [x] 打击反馈（暂停帧、屏幕震动）
- [x] HP 系统与胜负判定
- [x] 简单占位符美术（方块）

### 不包含功能 (Out of Scope)
- [ ] 完整招式系统
- [ ] 节点地图探索
- [ ] 养成系统
- [ ] 音效与音乐
- [ ] 正式美术资源
- [ ] 存档系统
- [ ] 多语言支持

---

## 7. 里程碑

### Phase 0: 原型验证 (当前)
**目标**: 验证核心玩法
**交付物**:
- 两个方块自动对打
- 教练指令系统可用
- 打击感基础实现

**验收标准**:
- 战斗有节奏感和来回感
- 切换教练指令能明显感到行为变化

### Phase 1: 核心系统
**目标**: 完善战斗系统
**交付物**:
- 完整六维属性系统
- 基础招式系统
- 状态机完善
- 基础 UI

### Phase 2: 探索系统
**目标**: 实现 Roguelike 结构
**交付物**:
- 节点地图生成
- 各类型节点实现
- 单次游戏流程完整

### Phase 3: 内容填充
**目标**: 丰富游戏内容
**交付物**:
- 多种拳手类型
- 丰富的招式库
- 多样的事件
- 基础美术替换

### Phase 4: 打磨上线
**目标**: 准备发布
**交付物**:
- 完整美术资源
- 音效音乐
- 平衡性调整
- Bug 修复

---

## 8. 风险与缓解措施

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| AI 决策不够有趣 | 中 | 高 | 早期原型验证，快速迭代概率表 |
| 教练指令感知不明显 | 中 | 高 | 加强视觉反馈，调大修正系数 |
| 战斗缺乏节奏感 | 中 | 中 | 引入决策冷却、动作时长控制 |
| 平衡性问题 | 高 | 中 | 设计数据驱动系统，便于调参 |
| 开发周期过长 | 中 | 中 | 严格控制 MVP 范围，分阶段交付 |

---

## 附录

### A. 决策概率表示例

**基础概率表** (距离=CLOSE, HP=HEALTHY):
| 行动 | 基础概率 |
|------|----------|
| 攻击 | 40% |
| 防御 | 25% |
| 回避 | 15% |
| 反击 | 10% |
| 待机 | 10% |

### B. 教练指令修正

| 指令 | 攻击修正 | 防御修正 | 回避修正 | 反击修正 |
|------|----------|----------|----------|----------|
| 猛攻 | ×1.8 | ×0.3 | ×0.8 | ×1.2 |
| 均衡 | ×1.0 | ×1.0 | ×1.0 | ×1.0 |
| 防守 | ×0.4 | ×1.8 | ×1.5 | ×0.8 |

### C. 状态机状态定义

| 状态 | 说明 | 可转换到 |
|------|------|----------|
| IDLE | 待机 | WALK, ATTACK, DEFEND, EVADE |
| WALK | 移动 | IDLE, ATTACK, DEFEND, EVADE |
| ATTACK | 攻击中 | RECOVERY |
| DEFEND | 防御中 | IDLE, HIT |
| EVADE | 闪避中 | IDLE |
| HIT | 受击中 | RECOVERY |
| RECOVERY | 恢复中 | IDLE |
